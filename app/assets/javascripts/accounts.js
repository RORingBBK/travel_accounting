$(document).ready(function() {
  var creditTotal, debitTotal, table, tr;
  table = $('#account-table').DataTable();

  $('.best_in_place').best_in_place();

  tr = $('table#account-table tr:last').clone(true, true);
  tr.find('td.sorting_1').replaceWith("<td><b>Total</b></td>");
  tr.find('td div.ui-widget').replaceWith("");
  tr.find('td span.hell').replaceWith("");
  tr.find('td span.debit').addClass("total-debit");
  tr.find('td span.total-debit').removeClass("debit");
  tr.find('td span.credit').addClass("total-credit");
  tr.find('td span.total-credit').removeClass("credit");
  tr.find('td:last').replaceWith("<td><td>");
  debitTotal = 0;
  $('.debit').each(function() {
    var stval;
    stval = parseFloat($(this).text());
    debitTotal += isNaN(stval) ? 0 : stval;
  });
  tr.find('td span.total-debit').text(debitTotal.toFixed(2));
  creditTotal = 0;
  $('.credit').each(function() {
    var stval;
    stval = parseFloat($(this).text());
    creditTotal += isNaN(stval) ? 0 : stval;
  });
  tr.find('td span.total-credit').text(creditTotal.toFixed(2));
  tr.show();
  $('table tbody').append(tr);
  $('#account-table tbody tr td').keypress(function(e) {
    var account_id, credit, debit, next_id;

    account_id = ($(this).find('span:first').attr('id')).split('_')[4];

    if (e.which === 13) {
      next_id = $(this).closest('td').next('td').find('span:first').attr('id');
      $('#' + next_id).click();
      debit = parseInt($('#best_in_place_account_' + account_id + '_debit').text() || $('#best_in_place_account_' + account_id + '_debit')[0].dataset.bipOriginalContent);
      credit = parseInt($('#best_in_place_account_' + account_id + '_credit').text() || $(this).find('span:first').attr("data-bip-original-content"));

      if (/^\+?[1-9][\d]*$/.test(debit) === false) {
        $('#best_in_place_account_' + account_id + '_debit').text("-");
      }
      if (/^\+?[1-9][\d]*$/.test(credit) === false) {
        $('#best_in_place_account_' + account_id + '_credit').text("-");
      }
      debitTotal = 0;
      $('.debit').each(function() {
        var stval;
        stval = parseFloat($(this).text());
        debitTotal += isNaN(stval) ? 0 : stval;
      });
      tr.find('td span.total-debit').text(debitTotal.toFixed(2));
      creditTotal = 0;
      $('.credit').each(function() {
        var stval;
        stval = parseFloat($(this).text());
        creditTotal += isNaN(stval) ? 0 : stval;
      });
      return tr.find('td span.total-credit').text(creditTotal.toFixed(2));
    }
  });
});

// ---
// generated by coffee-script 1.9.2